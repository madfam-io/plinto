# Nixpacks configuration for FastAPI deployment
[phases.setup]
nixPkgs = [
  "python311",
  "postgresql15",
  "gcc",
  # SAML/XML processing dependencies
  "libxml2",
  "libxmlsec1",
  "libxslt",
  "pkgconfig",
  "openssl"
]

[phases.install]
cmds = [
  "pip install --upgrade pip",
  # Set environment variables for XML library compilation
  "export PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/nix/store/*/lib/pkgconfig",
  "export LIBXML2_VERSION=$(pkg-config --modversion libxml-2.0)",
  "export LIBXMLSEC1_VERSION=$(pkg-config --modversion xmlsec1)",
  "pip install -r requirements.txt"
]

[phases.build]
# No build step needed for Python API

[start]
cmd = "uvicorn app.main:app --host 0.0.0.0 --port ${PORT:-8000}"